server {
    brotli on;
    brotli_static on;
    listen 80;
    server_name dev.gekkard.com web.gekkard.com localhost;

    add_header Content-Security-Policy "default-src 'self' 'unsafe-inline' data: *.gekkard.com *.gekkard.com:6789";
    add_header Content-Security-Policy "connect-src 'self' 'unsafe-inline' *.gekkard.com *.gekkard.com:6789";
    add_header Content-Security-Policy "script-src 'self' 'unsafe-inline' *.gekkard.com *.gekkard.com:6789";
    add_header Content-Security-Policy "style-src 'self' 'unsafe-inline' *.gekkard.com";
    add_header Content-Security-Policy "font-src 'self' data: *.gekkard.com";
    #access_log  /var/log/nginx/host.access.log  main;

    gzip on;
    gzip_vary on;
    gzip_min_length 512;
    gzip_proxied expired no-cache no-store private auth;
    gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml application/javascript application/json;
    gzip_disable "MSIE [1-6]\.";

    error_page 404 /404.html;

    root /usr/share/nginx/html;
    index /index.html; # индексный файл по умолчанию всегда из корня /index.html

    location / {
         # все запросы на файлы и папки в общем виде направляем на index.html в корне         
        rewrite ^ /index.html break;  
        add_header Cache-Control "public, max-age=60, stale-while-revalidate=2592000"; # 60 секунд в кеше затем проверка, но можно использовать месяц из кеша    
    }

    location ~* \.(js|css) {
        try_files $uri =404;
        # год - срок жизни для скриптов и стилей без проверок, так как они изменяются только с изменением имени или версии
        add_header Cache-Control "public, max-age=31536000, immutable";
    }

    location ~* \.(svg|png|ico|jpg|xml|woff2|woff|ttf|json|html|webmanifest)$ {
        try_files $uri =404;
        add_header Cache-Control "public, max-age=604800, stale-while-revalidate=2592000, no-transform"; # 7 дней актуально потом 30 дней чтобы проверить
    }
}